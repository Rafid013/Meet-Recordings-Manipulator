{"files":[{"id":"bb8c6446-c90f-4b48-8534-92b14626d8e4","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Dhaka\",\n  \"dependencies\": {\n    \"enabledAdvancedServices\": [\n      {\n        \"userSymbol\": \"Drive\",\n        \"version\": \"v2\",\n        \"serviceId\": \"drive\"\n      }\n    ]\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"ea2bfb59-df6d-40b9-8480-28d3db35918d","name":"Code","type":"server_js","source":"function leapYear(year)\n{\n  return ((year % 4 \u003d\u003d 0) \u0026\u0026 (year % 100 !\u003d 0)) || (year % 400 \u003d\u003d 0);\n}\n\n\nfunction mainFunction() {\n  // specify the title pattern, destion folder id and source folder id in the statement below.\n  var course_name \u003d \"\u0027CSE 2213 Discrete Mathematics\u0027\";   //remember to give extra literals\n  \n  // can be obtained from the url (last code of the url)\n  var source_folder_id \u003d \"\u00271N9ApLQZGTYCwFTUfRpwoXExqnDeWa3j5\u0027\"; //remember to give extra literals\n\n  //add section names and corresponding destination folder ids \n  // can be obtained from the url (last code of the url)\n  var sections_folder_id \u003d {\u0027F\u0027: \u00271cLcwt9hDdnadl6CJGURic45CLic90Fx_\u0027, \u0027G\u0027: \u00271voLADlhTf7vugzMwsuKgzImXx0_jMC7-\u0027, \u0027H\u0027: \u00271xbLYITxbIZXL-trmpxdiDzTPROz3zcGY\u0027};\n\n  var files \u003d DriveApp.searchFiles(\"title contains \" + course_name + \" and parents in \" + source_folder_id);\n  while (files.hasNext()) {\n    var file \u003d files.next();\n    var fileName \u003d file.getName();\n    // get the first position of bracket to get the section name\n    var section \u003d fileName.slice(fileName.indexOf(\"(\") + 1, fileName.indexOf(\"(\") + 2); \n   \n    // get the date of the recording, it\u0027s in GMT-7 format, that is why added +1 to date\n    var date \u003d fileName.substr(fileName.lastIndexOf(\"(\") + 1, 10);\n    var day \u003d parseInt(date.slice(date.lastIndexOf(\u0027-\u0027) + 1, date.lastIndexOf(\u0027-\u0027) + 3));\n    var month \u003d parseInt(date.slice(date.indexOf(\u0027-\u0027) + 1, date.indexOf(\u0027-\u0027) + 3));\n    var year \u003d parseInt(date.slice(0, 4));\n\n    // date increment will depend on month and day, if last day, next day will be day 1\n    if (month \u003d\u003d 1 || month \u003d\u003d 3 || month \u003d\u003d 5 || month \u003d\u003d 7 || month \u003d\u003d 8 || month \u003d\u003d 10 || month \u003d\u003d 12){\n      if (day \u003d\u003d 31) {\n        day \u003d 1;\n        month \u003d month + 1;\n        if (month \u003d\u003d 13) {\n          year \u003d year + 1\n          month \u003d 1\n        }\n      }\n      else day \u003d day + 1;\n    }\n    else if (month \u003d\u003d 2){\n      if (leapYear(year)) {\n        if (day \u003d\u003d 29) {\n          day \u003d 1;\n          month \u003d month + 1;\n        }\n        else day \u003d day + 1;\n      }\n      else {\n        if (day \u003d\u003d 28) {\n          day \u003d 1;\n          month \u003d month + 1;\n        }\n        else day \u003d day + 1;\n      }\n    }\n    else {\n      if (day \u003d\u003d 30) {\n        day \u003d 1;\n        month \u003d month + 1;\n      }\n      else day \u003d day + 1;\n    }\n    day \u003d day.toString();\n    month \u003d month.toString();\n    if (day.length \u003d\u003d 1)\n      day \u003d \"0\" + day;\n    if (month.length \u003d\u003d 1)\n      month \u003d \"0\" + month;\n    \n    var modifiedDate \u003d date.replace(date, year + \u0027-\u0027 + month + \u0027-\u0027 + day);\n    \n    // rename file\n    var modifiedFileName \u003d fileName.slice(0, fileName.indexOf(\u0027)\u0027) + 1) + \" (\" + modifiedDate + \")\";\n    file.setName(modifiedFileName);\n\n    // change sharing option\n    file.setSharing(DriveApp.Access.ANYONE, DriveApp.Permission.VIEW);\n    \n\n    // enable download option for viewers\n    var fileId \u003d file.getId(); \n    const url \u003d \"https://www.googleapis.com/drive/v2/files/\" + fileId;\n    const res \u003d UrlFetchApp.fetch(url, {\n      method: \"patch\",\n      headers: {authorization: \"Bearer \" + ScriptApp.getOAuthToken()},\n      contentType: \"application/json\",\n      payload: JSON.stringify({copyRequiresWriterPermission: false, writersCanShare: true}),\n    });\n\n    // move file\n    // folder name \n    var folder \u003d DriveApp.getFolderById(sections_folder_id[section]);\n    file.moveTo(folder);\n  }\n}\n"}]}